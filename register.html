<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>立即注册</title>
		<link rel="stylesheet" type="text/css" href="css/common.css"/>
		<link rel="stylesheet" type="text/css" href="css/register.css"/>
	</head>
	<body>
		<div class="form">
			<div id="i">
				<span class="text">手机号：</span><input type="text" id="parPhone" placeholder="请填写手机号" style="color: white;"/>
			</div>
			<div id="i">
				<span class="text">验证码：</span><input type="text" id="code" placeholder="输入验证码" style="color: white;"/><input type="button" class="getCode" id="getCode" value="获取验证码" />
			</div>
			<div id="i">
				<span class="text">学&nbsp;&nbsp;&nbsp;生：</span><select class="parentStudent" name="stuName" id="selectId"></select>
			</div>
			<button id="register" >立即注册</button>
		</div>
	</body>
</html>
<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
<script src="js/registerAndchangePwd.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
	
	
　　//获取验证码
　　$('#getCode').click(function(){
　　　　var ipone  = isIpone($('#parPhone').val());//手机号验证
　　　　var parPhone = document.getElementById('parPhone').value;
　　　　if(ipone  == true){
　　　　　　//请求
　　　　　　try {
　　　　　　　　$.ajax({
　　　　　　　　　　url: 'http://localhost:8080/parentsApi/getCode',
　　　　　　　　　　timeout: 8000,
　　　　　　　　　　type: 'POST',
				  data: {
					 "parPhone":parPhone
				  },
				  xhrFields: { //为true实现跨域访问
					  withCredentials: true
				  },
　　　　　　　　　　success: function(result) {
　　　　　　　　　　　　try {
　　　　　　　　　　　　　　result = result.trim();
　　　　　　　　　　　　　　result = result.replace(/\n/g, '');//此处做去空格处理
　　　　　　　　　　　　　　if(result == '0'){
							alert('该号码已注册');
						}else {
							alert("验证码已发送，请注意查收");
　　　　　　　　　　　　　　　 time();//调用
　　　　　　　　　　　　　　　 document.getElementById('code').setAttribute('class',result);//让该元素添加class
　　　　　　　　　　　　　　}
　　　　　　　　　　　　} catch(e) {
　　　　　　　　　　　　　　// alert("接口错误，请联系客服");
　　　　　　　　　　　　}
　　　　　　　　　　},
　　　　　　　　　　error: function(xhr, status, error) {
　　　　　　　　　　　　if(status == "error")
　　　　　　　　　　　　alert('请检查网络连接');
　　　　　　　　　　}
　　　　　　　　});
　　　　　　} catch(error) {
　　　　　　　　alert("请检查网络连接");
　　　　　　}
　　　　}
　　});

window.onload = SearchVehicleTag();//加载页面时自动执行方法
	
	function SearchVehicleTag(){
		$.ajax({
			 url: 'http://localhost:8080/student/findAllStudent',
			 type: "post",
			 dataType: "json",
			 contentType: "application/json",
			 traditional: true,
			 success: function (res) {
				// console.log(res.data)
				var data = res.data;
				for (var i = 0; i < data.length; i++) {
				     var jsonObj =data[i];
					 // console.log(jsonObj)
					$("#selectId").append("<option value='"+jsonObj.stuNo+"'>" + jsonObj.stuName + "</option>");
				}
			 },
			 error: function (msg) {
				 alert("数据加载出错，请重试！");
			 },
		 });
	}

	
	//点击注册
	$('#register').click(function(){
		var ipone  = isIpone($('#parPhone').val());//手机号验证
		var parPhone = document.getElementById('parPhone').value;
		var code = document.getElementById('code').value;
		var stuNo = document.getElementById('selectId').value;
		
		// console.log(stuNo)
		if(ipone != true){
　　　　　　return;
　　　　 }
		if(parPhone == ''){
			alert("请输入手机号");
			return;
		}
		if(code == ''){
			alert("请填写验证码");
			return;
		}
		if(stuNo == ''){
			alert("请选择学生");
			return;
		}
		if(ipone == true) {
　　　　　　$.ajax({
				url : 'http://localhost:8080/parentsApi/registerParents',
				type: 'POST',
				dataType : "json",
				data:{
					"parPhone":parPhone,
					"code":code,
					"stuNo":stuNo
				},
				xhrFields: { //为true实现跨域访问
					withCredentials: true
				},
				success:function (result){
					console.log(result.data)
					if(result != null){
						alert("注册成功！")
						localStorage.setItem("parentLogin",JSON.stringify(result.data));
						window.location.href = "parentsMine.html";
					}
				}
			});
	　　}
	});
	
</script>
